@model QuizApp.Models.Quiz      
@using System.Text.Json

@{
    ViewData["Title"] = "Quiz Details";

    // Project server model to a JS-friendly anonymous object and serialize to JSON
    var questionsJson = JsonSerializer.Serialize(
        Model.Questions.Select(q => new
        {
            id = q.Id,
            text = q.Text,
            points = q.Points,
            options = q.Options.Select(o => new
            {
                id = o.Id,
                text = o.Text,
                isCorrect = o.IsCorrect
            })
        })
    );
}

<div id="quiz-details-app">

    <h2>@Model.Title</h2>
    <p>@Model.Description</p>

    <h3>Questions</h3>

    <!-- If no questions -->
    <div v-if="questions.length === 0">
        <p>No questions added yet.</p>

        <a class="btn btn-primary"
           asp-controller="Questions"
           asp-action="Create"
           :asp-route-quizId="quizId">
            Add First Question
        </a>
    </div>

    <!-- If there are questions -->
    <div v-else>
        <a class="btn btn-success mb-3"
           asp-controller="Questions"
           asp-action="Create"
           :asp-route-quizId="quizId">
            Add Question
        </a>

        <ul class="list-group">
            <li class="list-group-item" v-for="q in questions" :key="q.id">

                <strong>{{ q.text }}</strong> ({{ q.points }} points)

                <ul>
                    <li v-for="opt in q.options" :key="opt.id"
                        :style="opt.isCorrect ? 'color:green;font-weight:bold' : ''">

                        {{ opt.text }}
                        <span v-if="opt.isCorrect">âœ“</span>
                    </li>
                </ul>

                <a asp-controller="Questions"
                   asp-action="Edit"
                   :asp-route-id="q.id">Edit</a>

                |

                <a asp-controller="Questions"
                   asp-action="Delete"
                   :asp-route-id="q.id">Delete</a>
            </li>
        </ul>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    quizId: @Model.QuizId,
                    questions: @Html.Raw(questionsJson)
                };
            }
        }).mount("#quiz-details-app");

        // client-side error logger
        window.addEventListener("error", function (event) {
            console.error("Client error on Quiz Details page:", event.error || event.message);
            alert("Something went wrong. Please try again.");
        });
    </script>
}
